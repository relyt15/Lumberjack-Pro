import java.util.Optional;
import javafx.scene.control.CheckBox;
import javafx.scene.control.Label;
import javafx.scene.layout.HBox;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.control.Button;
import javafx.scene.control.TextField;
import javafx.scene.layout.VBox;

public class ProjectPane extends HBox {
    private Project project;
    private TextField nameField;
    private TextField dueDateField;
    private TextField descriptionField;
    private Label nameLabel;
    private Label dueDateLabel;
    private Label descriptionLabel;
    private CheckBox completedCheckBox;
    private Button saveButton;
    private Button editButton;
    private VBox taskListContainer;

    public ProjectPane(Project project) {
        this.project = project;
        ProjectService projServ = new ProjectService();
        
        // Text field for Project Name
        nameField = new TextField(project.getProjectName());
        nameField.setPromptText("Project Name");

        
        // Label for Project Name
        nameLabel = new Label(project.getProjectName());
        nameLabel.setStyle("-fx-font-weight: bold;");
        

        // Text field for Project Due Date
        dueDateField = new TextField(project.getProjectDueDate());
        dueDateField.setPromptText("Due Date (YYYY-MM-DD)");
        
        // Label for Due Date
        dueDateLabel = new Label(project.getProjectDueDate());
        
        // Text field for Project Description
        descriptionField = new TextField(project.getProjectDescription());
        descriptionField.setPromptText("Project Description");
        
        // Label for Project Description
        descriptionLabel = new Label(project.getProjectDescription());

        // Checkbox for Completion
        completedCheckBox = new CheckBox();
        completedCheckBox.setSelected(project.isProjectCompleted());
        
        // Save Button to update Project details
        saveButton = new Button("Save");
        saveButton.setOnAction(e -> saveProjectDetails());
        
        //Edit button to update Project details
        editButton = new Button("Edit");
        editButton.setOnAction(e -> editProjectDetails());

        // Update Project when checkbox is clicked
        completedCheckBox.setOnAction(e -> {
            if (completedCheckBox.isSelected()) {
                project.setProjectCompleted(); // Mark Project as completed
                projServ.removeProject(project);
            } else {
                project.setProjectStatus("pending"); // Set status back to pending.
            }
        });

        // Styling and Spacing
        this.setSpacing(15);
        this.setPadding(new Insets(10));
        this.setAlignment(Pos.CENTER_LEFT);

        // Add elements to the pane
        this.getChildren().addAll(nameLabel, descriptionLabel, dueDateLabel,
                completedCheckBox, editButton);
    }
    
    private void saveProjectDetails() {
        project.setProjectName(nameField.getText());
        project.setProjectDueDate(dueDateField.getText());
        project.setProjectDescription(descriptionField.getText());
        if (completedCheckBox.isSelected()) {
            project.setProjectCompleted();
        }
        else {
            project.setProjectStatus("Pending");
        }
    } // end saveProjectDetails
    
    private void editProjectDetails(){
        ProjectService man1 = new ProjectService();
        
        Optional<Project> result = man1.editProjectDialog(project);
        result.ifPresent(updated -> {
            // Update the local project reference
            project = updated;

            // Update UI labels
            nameLabel.setText("Name: " + project.getProjectName());
            dueDateLabel.setText("Due Date: " + project.getProjectDueDate());
            descriptionLabel.setText("Description: " + project.getProjectDescription());
        });
    }

}
